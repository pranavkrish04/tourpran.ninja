<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>SQL Injection | TourPran Blogs</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="SQL Injection">
<meta name="author" content="tourpran">
<meta property="og:locale" content="en_US">
<meta name="description" content="What is a Database: A database can be thought as a collection of data in an organised manner. When companies have huge amounts of data to be stored, using databases is the key for efficient usage of the data.">
<meta property="og:description" content="What is a Database: A database can be thought as a collection of data in an organised manner. When companies have huge amounts of data to be stored, using databases is the key for efficient usage of the data.">
<link rel="canonical" href="http://tourpran.me/blogs/2021/03/27/sqlinjection.html">
<meta property="og:url" content="http://tourpran.me/blogs/2021/03/27/sqlinjection.html">
<meta property="og:site_name" content="TourPran Blogs">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-03-27T00:00:00+05:30">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="SQL Injection">
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://tourpran.me/blogs/2021/03/27/sqlinjection.html","headline":"SQL Injection","dateModified":"2021-03-27T00:00:00+05:30","datePublished":"2021-03-27T00:00:00+05:30","author":{"@type":"Person","name":"tourpran"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://tourpran.me/blogs/2021/03/27/sqlinjection.html"},"description":"What is a Database: A database can be thought as a collection of data in an organised manner. When companies have huge amounts of data to be stored, using databases is the key for efficient usage of the data.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
  <!-- and it's easy to individually load additional languages -->
  <script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="http://tourpran.me/feed.xml" title="TourPran Blogs">
</head>
<body>



















<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="TourPran Blogs" src="" onerror="this.style.display='none'">
  TourPran Blogs
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/">HOME</a><a class="page-link" href="/pwntrain.html">PWN TRAINING</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/portfolio.html">PORTFOLIO</a>




</div>
        </nav>
</div>
  </div>
</header>

<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  })();
</script>










































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.matches('a')) {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">SQL Injection</h1>
  <h3 class="post-subtitle"></h3>

  <p class="post-meta">
    <time class="dt-published" datetime="2021-03-27T00:00:00+05:30" itemprop="datePublished"><i class="fa fa-calendar"></i> 27 Mar 2021
    </time>

    





















    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 5 mins</span>
  </p>
<div class="post-tags">
<a class="post-tag" href="/tags.html#sql">#sql</a><a class="post-tag" href="/tags.html#Injection">#Injection</a><a class="post-tag" href="/tags.html#SQLI">#SQLI</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h3 id="what-is-a-database">What is a Database:</h3>
<p>A database can be thought as a collection of data in an organised manner. When companies have huge amounts of data to be stored, using databases is the key for efficient usage of the data.</p>

<p><img src="/assets/images/databasepic.png" alt=""></p>

<h3 id="sql">SQL:</h3>
<p>SQL or Structured Query Language is just a way to talk to the database and manipulate the data by the program. In most Database management systems SQL language is used. This blog post is divided into <code class="language-plaintext highlighter-rouge">basics of sql</code> and <code class="language-plaintext highlighter-rouge">exploitation of sql</code>.</p>

<h3 id="sql-basics">SQL Basics:</h3>

<h4 id="creating-a-database">Creating a Database:</h4>

<p>In order to follow this blog post itâ€™ll be helpfull to have mysql installed. First we will create and use a Database in mysql called testdb. Now this database can use used to store multiple tables where each table can be used to store different types of datas. For example a login table can be used to store all usernames and passwords and a store website can use another table to store all their products and prices with it.</p>

<p><img src="/assets/images/databasecreation.png" alt=""></p>

<h4 id="creating-tables">Creating tables:</h4>

<p>For the fun of it lets create a table called person since everyone has their own unique <code class="language-plaintext highlighter-rouge">features</code>. By features I mean their name, height and weigth.</p>

<p><img src="/assets/images/tablesexample.png" alt=""></p>

<h4 id="access-the-data">Access the data:</h4>

<p>Inorder to get the required data we use SELECT statements. when we have lines of select statements and commands to give to the databases we call them queries.</p>

<p>note: * means everything (all)</p>

<p><img src="/assets/images/queryexample.png" alt=""></p>

<p>Here we are select everything present in the table called person.</p>

<p>When we have multiple number of objects in our table we can use a element present in each object that is unique. Most of the time our names our unique so we can access our object with the help of out name.</p>

<p><img src="/assets/images/queryexample1.png" alt=""></p>

<h4 id="login-system">Login system:</h4>

<p>In our login system (which we will use to hack) we have used sql query to check if the user and password given my the user is correct. The pseudo code is given below:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT id FROM admin WHERE username = '</span><span class="nv">$myusername</span><span class="s2">' and passcode = '</span><span class="nv">$mypassword</span><span class="s2">'"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span><span class="nv">$sql</span><span class="p">);</span> <span class="c1"># Send the sql query to DataBase</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nf">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="no">MYSQLI_ASSOC</span><span class="p">);</span> <span class="c1"># Fetchs a result row as a array</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">echo</span> <span class="s2">"Success! "</span> <span class="c1"># Tell the user the login creds were correct</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
	<span class="k">echo</span> <span class="s2">"Invalid "</span> <span class="c1"># Tell the user the login creds were incorrect</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="different-exploitation-techniques">Different Exploitation Techniques:</h3>

<h4 id="simple-login-bypass">Simple login bypass:</h4>

<p>We can see that there are 2 users in the table. Obviously in the real world application there wont be a table showing the credentials, inorder for learning purpose I have made them visible. Now lets check if there is a sql injection possible.</p>

<p><img src="/assets/images/loginlocalhost.png" alt=""></p>

<p><img src="/assets/images/sqllocalhosterror.png" alt=""></p>

<p>Now If you are following the blog correctly you would have already know that this error is due to the â€˜ (single quote) I gave. So the query looks like</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT id FROM admin WHERE username = '' ' and passcode = 'a'
</code></pre></div></div>
<p>The unmatched single quotes make the query break and thereby telling us there are chances for a SQLInjection. Also a point to note is, its not required to get an error every time to prove there is a SQL Injection. Infact in most real world applications you would be left with blind sql injections which doesnt give you any output (covered later in this blog).</p>

<p>So we will use basic boolean logic for the first attack. We will tell the SQL Query that the username is true and passcode is true. So this will return the entire table and mostly likely we will be logged in as the first user (extreme case, likely never happens).</p>

<p><img src="/assets/images/sqlsimplelogin1.png" alt="">
<img src="/assets/images/simpleloginsql2.png" alt=""></p>

<p>Here we can see I gained access as tourpran who is the first user. Also in the query I managed to say that <code class="language-plaintext highlighter-rouge">username='' or TRUE</code> which will always be true, same for the password.</p>

<p>We can also login as admin if we pass the following credentials.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UserName: admin
password: ' or 'a'='a

SELECT id FROM admin WHERE username = 'admin' and passcode = '' or 'a'='a'

or 

username: ' or '1'='1
password: ' or 'a'='a' and username='admin' ; #

SELECT id FROM admin WHERE username = '' or 'a'='a' and passcode = '' or 'a'='a' and username='admin' ; #'

# - comment the rest of the line
</code></pre></div></div>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/writeup/2021/02/07/babyropdice.html" title="babyROP | DiceGang CTF">babyROP | DiceGang CTF</a><a class="next" href="/pwn-training/2021/05/09/simple-ret2shellcode-training1.html" title="Return to Shellcode">Return to Shellcode</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/writeup/2020/04/30/pwnabletw2.html" title="Return to Shellcode">ORW - pwnable.tw</a></li>
<li><a class="post-link" href="/blogs/2019/09/29/myfirstctf.html" title="Return to Shellcode">My First CTF</a></li>
<li><a class="post-link" href="/writeup/2021/02/07/babyropdice.html" title="Return to Shellcode">babyROP | DiceGang CTF</a></li>
<li><a class="post-link" href="/pwn-training/2021/05/09/simple-ret2shellcode-training1.html" title="Return to Shellcode">Return to Shellcode</a></li>
</ul>
    </div>
<div class="post-comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://tourpran.me/blogs/2021/03/27/sqlinjection.html';
    this.page.identifier = 'http://tourpran.me/blogs/2021/03/27/sqlinjection.html';
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://tourpran.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items=20) {
      var items = menuContent.firstChild.children;

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

</footer>
</body>
</html>
